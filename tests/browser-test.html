<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RGB SDK Browser Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        h1 {
            color: #333;
        }
        h2 {
            color: #666;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 4px;
        }
        button {
            background: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        button:hover {
            background: #45a049;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
            word-break: break-all;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
        .loading {
            color: #666;
            font-style: italic;
        }
        input[type="text"], textarea {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        textarea {
            min-height: 100px;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ RGB SDK Browser Test</h1>
        <p>This page tests the RGB SDK in a browser environment using <code>@bitcoindevkit/bdk-wallet-web</code>.</p>
    </div>

    <div class="container">
        <h2>Test Configuration</h2>
        <div class="test-section">
            <label><strong>Mnemonic:</strong></label>
            <input type="text" id="mnemonic" value="poem twice question inch happy capital grain quality laptop dry chaos what" />
        </div>
        <div class="test-section">
            <label><strong>Network:</strong></label>
            <select id="network">
                <option value="testnet" selected>Testnet</option>
                <option value="mainnet">Mainnet</option>
                <option value="signet">Signet</option>
                <option value="regtest">Regtest</option>
            </select>
        </div>
    </div>

    <div class="container">
        <h2>Test 1: Generate Keys</h2>
        <div class="test-section">
            <button id="testGenerateKeys">Test generateKeys()</button>
            <div id="generateKeysResult"></div>
        </div>
    </div>

    <div class="container">
        <h2>Test 2: Derive Keys from Mnemonic</h2>
        <div class="test-section">
            <button id="testDeriveKeys">Test deriveKeysFromMnemonic()</button>
            <div id="deriveKeysResult"></div>
        </div>
    </div>

    <div class="container">
        <h2>Test 3: Sign PSBT (UTXO Creation)</h2>
        <div class="test-section">
            <label><strong>Unsigned PSBT (UTXO Creation):</strong></label>
            <textarea id="utxoPsbt" rows="4">cHNidP8BAP01AQIAAAABtSecjg4J41fmQtoh4TTlQdnu6iifN5ogbVWEAXrUWhoAAAAAAP3///8G6AMAAAAAAAAiUSDzKPGEYMWF2Spr+6GDDaiByz+OjfjlV3Lfr/zYKZ2iB+gDAAAAAAAAIlEg83490lnilgZRgrHnETy+JEjou1md47ACmb0kn5rO2+joAwAAAAAAACJRIHD6gvLQXWd4BvEW0YjxA0z50cxfC3ZUhKXnKhPTS1B+6AMAAAAAAAAiUSCXxMTRByl/+IGyzvdE6V+4ac0UOeEwe1dl3zb8ceaZ5OgDAAAAAAAAIlEg3oU2/GUMIeYj4d/R1dK5ThTLhkg7JAhjPOLjNqb215YYEzEBAAAAACJRIHn8VHdi5k8OITo7LrsqYr+cQIASgZTwvtfvYoBHBxpWoXVIAAABASsALTEBAAAAACJRIM9hxZBkyMxn4vyYOosTZEYQIMqQZRSwxigi1aTQwJLrIRaUhLceLJAwJvzah8652iBUot/I4ZG5LVNrof4L451TuRkApmv/71YAAIABAACAAAAAgAEAAAAAAAAAARcglIS3HiyQMCb82ofOudogVKLfyOGRuS1Ta6H+C+OdU7kAAQUgeHCOVR20fg1Bz+fM/Cpg3KrkSlmKQDLwInucZ2bCMcwhB3hwjlUdtH4NQc/nzPwqYNyq5EpZikAy8CJ7nGdmwjHMGQCma//vVgAAgB+fDIAAAACAAAAAAAIAAAAAAQUgzBIX4uwl2L4m53HESkMyqyevlalsmf3tw9nH0r3KQoIhB8wSF+LsJdi+JudxxEpDMqsnr5WpbJn97cPZx9K9ykKCGQCma//vVgAAgB+fDIAAAACAAAAAAAMAAAAAAQUgs43Fa7pRIMJTLGHkWwyCRf16wo3uSS/3CDv0c550QBkhB7ONxWu6USDCUyxh5FsMgkX9esKN7kkv9wg79HOedEAZGQCma//vVgAAgB+fDIAAAACAAAAAAAQAAAAAAQUgaqAn3Z3FYWYqPiTb2KCMBirkLH3ZnhE1Q7NpCOiuJBkhB2qgJ92dxWFmKj4k29igjAYq5Cx92Z4RNUOzaQjoriQZGQCma//vVgAAgB+fDIAAAACAAAAAAAEAAAAAAQUgnZNdhk/w7sXuE3/fLeNHq5My6f6IqMI5KrZAVeoZdnUhB52TXYZP8O7F7hN/3y3jR6uTMun+iKjCOSq2QFXqGXZ1GQCma//vVgAAgB+fDIAAAACAAAAAAAAAAAAAAQUg+5xo2r852/jJjwIpMPXdsWsse2hpIxAhJhP6YDPcrrIhB/ucaNq/Odv4yY8CKTD13bFrLHtoaSMQISYT+mAz3K6yGQCma//vVgAAgAEAAIAAAACAAQAAAAEAAAAA</textarea>
            <button id="testSignUtxo">Test signPsbt() - UTXO</button>
            <div id="signUtxoResult"></div>
        </div>
    </div>

    <div class="container">
        <h2>Test 4: Sign PSBT (Send)</h2>
        <div class="test-section">
            <label><strong>Unsigned PSBT (Send):</strong></label>
            <textarea id="sendPsbt" rows="4">cHNidP8BAIkCAAAAASs6FZbqRIdKgFpPLMi0aTfvBFqDT6JbTdDpK6P6tBhCBAAAAAD9////AgAAAAAAAAAAImog6wXBZTGshFceO1rQtCoz1eDEfgGcWdvMvHLJlmozjEKEAQAAAAAAACJRIBs/61D42aMRdH4+SEPBqOtdv4dNSIY5r8iJqACWZ5bv3XlIACb8A1JHQgH0bKC/icu0bP1eYxQ6uIpPwCU89RNB/G+yHcp4C0e3DJ0AAN1GxJO34z9oOLJIdFpzzqfl+e3voeFqTPSl45jd58mJ//////////8QJwAAAQDdRsSTt+M/aDiySHRac86n5fnt76Hhakz0peOY3efJiaAPAgABAKAPAQIAAAABAAAAaq+/lJND7LUI3gMAAAAAAAAB/GQgj9CN8+h6nKKR6li1Snudp05RyxxRBoOJ0VhYzfQICgAAAAAAAAAABvwDUkdCAgEAJvwDUkdCBN1GxJO34z9oOLJIdFpzzqfl+e3voeFqTPSl45jd58mJRN1GxJO34z9oOLJIdFpzzqfl+e3voeFqTPSl45jd58mJoA8CAPRsoL+Jy7Rs/V5jFDq4ik/AJTz1E0H8b7IdyngLR7cMAAEBK+gDAAAAAAAAIlEg3oU2/GUMIeYj4d/R1dK5ThTLhkg7JAhjPOLjNqb215YhFp2TXYZP8O7F7hN/3y3jR6uTMun+iKjCOSq2QFXqGXZ1GQCma//vVgAAgB+fDIAAAACAAAAAAAAAAAABFyCdk12GT/Duxe4Tf98t40erkzLp/oiowjkqtkBV6hl2dQAm/ANNUEMA3UbEk7fjP2g4skh0WnPOp+X57e+h4WpM9KXjmN3nyYkg/OYL9NoADeYnzQkU4TmgEJEIBWyTp0v1e1StQzxh8YYG/ANNUEMBCOSb4tcxJLMvBvwDTVBDECDrBcFlMayEVx47WtC0KjPV4MR+AZxZ28y8csmWajOMQgb8A01QQxH9PwEDAAAIAAAAAANp7skQJdswnsxrN/hH0Nzl+7GXQiel7Cq4pRCYRsvnkQAD78HzWyTQwyUtHa9FrbEEfmIcdwWoQ4MFewb7VuzpNOYAA617O8vSZCG3EdeaFfG/LLNx5vxK6Gd1mWukv9GGBr1CAANK4WCpInljss9tzwQ7WOcARnOZgXjE/5c2JsTrFZ17VwADkwf/OMoQPQy6+IHABqtMZdVjJJbK0fvFsDjEay6aqIkB3UbEk7fjP2g4skh0WnPOp+X57e+h4WpM9KXjmN3nyYn85gv02gAN5ifNCRThOaAQkQgFbJOnS/V7VK1DPGHxhgADNRqw8q4cMxyEceD9NOWnYfZBGtsLVvxmu96OG+cZgd4AA8wgXYyY/F/m1sEThgPwffAnxmAtQtAnMK9GhY82FnzLAeSb4tcxJLMvCPwFT1BSRVQBIOsFwWUxrIRXHjta0LQqM9XgxH4BnFnbzLxyyZZqM4xCAAEFIKu00zp2brpb5bM41nvP0Qkh9QiTklFIBPGRUophfkqnIQertNM6dm66W+WzONZ7z9EJIfUIk5JRSATxkVKKYX5KpxkApmv/71YAAIAfnwyAAAAAgAAAAAAGAAAAAA==</textarea>
            <button id="testSignSend">Test signPsbt() - Send</button>
            <div id="signSendResult"></div>
        </div>
    </div>

    <div class="container">
        <h2>Test 5: Run All Tests</h2>
        <div class="test-section">
            <button id="runAllTests">Run All Tests</button>
            <div id="allTestsResult"></div>
        </div>
    </div>

    <script type="importmap">
        {
            "imports": {
                "@bitcoindevkit/bdk-wallet-web": "../node_modules/@bitcoindevkit/bdk-wallet-web/bitcoindevkit.js"
            }
        }
    </script>
    <script type="module">
        // Import the SDK from the browser-bundled ESM module
        let sdk;
        
        async function loadSDK() {
            if (!sdk) {
                try {
                    // Import from the browser-bundled ESM module
                    sdk = await import('../dist/index.browser.mjs');
                    return true;
                } catch (error) {
                    console.error('Failed to load SDK:', error);
                    console.error('Error details:', error);
                    return false;
                }
            }
            return true;
        }

        function showResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.className = `result ${type}`;
            element.textContent = message;
        }

        async function testGenerateKeys() {
            const resultEl = document.getElementById('generateKeysResult');
            showResult('generateKeysResult', 'Loading SDK...', 'loading');
            
            if (!(await loadSDK())) {
                showResult('generateKeysResult', 'Failed to load SDK', 'error');
                return;
            }

            try {
                showResult('generateKeysResult', 'Generating keys...', 'loading');
                const network = document.getElementById('network').value;
                const keys = await sdk.generateKeys(network);
                
                const result = {
                    success: true,
                    mnemonic: keys.mnemonic,
                    xpub: keys.xpub,
                    account_xpub_vanilla: keys.account_xpub_vanilla,
                    account_xpub_colored: keys.account_xpub_colored,
                    master_fingerprint: keys.master_fingerprint
                };
                
                showResult('generateKeysResult', JSON.stringify(result, null, 2), 'success');
            } catch (error) {
                showResult('generateKeysResult', `Error: ${error.message}\n${error.stack}`, 'error');
            }
        }

        async function testDeriveKeys() {
            const resultEl = document.getElementById('deriveKeysResult');
            showResult('deriveKeysResult', 'Loading SDK...', 'loading');
            
            if (!(await loadSDK())) {
                showResult('deriveKeysResult', 'Failed to load SDK', 'error');
                return;
            }

            try {
                showResult('deriveKeysResult', 'Deriving keys...', 'loading');
                const mnemonic = document.getElementById('mnemonic').value.trim();
                const network = document.getElementById('network').value;
                
                const keys = await sdk.deriveKeysFromMnemonic(mnemonic, network);
                
                const result = {
                    success: true,
                    mnemonic: keys.mnemonic,
                    xpub: keys.xpub,
                    account_xpub_vanilla: keys.account_xpub_vanilla,
                    account_xpub_colored: keys.account_xpub_colored,
                    master_fingerprint: keys.master_fingerprint
                };
                
                showResult('deriveKeysResult', JSON.stringify(result, null, 2), 'success');
            } catch (error) {
                showResult('deriveKeysResult', `Error: ${error.message}\n${error.stack}`, 'error');
            }
        }

        async function testSignUtxo() {
            const resultEl = document.getElementById('signUtxoResult');
            showResult('signUtxoResult', 'Loading SDK...', 'loading');
            
            if (!(await loadSDK())) {
                showResult('signUtxoResult', 'Failed to load SDK', 'error');
                return;
            }

            try {
                showResult('signUtxoResult', 'Signing PSBT...', 'loading');
                const mnemonic = document.getElementById('mnemonic').value.trim();
                const psbt = document.getElementById('utxoPsbt').value.trim();
                const network = document.getElementById('network').value;
                
                const signed = await sdk.signPsbt(mnemonic, psbt, network);
                
                const result = {
                    success: true,
                    signedPsbt: signed,
                    length: signed.length,
                    prefix: signed.substring(0, 10)
                };
                
                showResult('signUtxoResult', JSON.stringify(result, null, 2), 'success');
            } catch (error) {
                showResult('signUtxoResult', `Error: ${error.message}\n${error.stack}`, 'error');
            }
        }

        async function testSignSend() {
            const resultEl = document.getElementById('signSendResult');
            showResult('signSendResult', 'Loading SDK...', 'loading');
            
            if (!(await loadSDK())) {
                showResult('signSendResult', 'Failed to load SDK', 'error');
                return;
            }

            try {
                showResult('signSendResult', 'Signing PSBT...', 'loading');
                const mnemonic = document.getElementById('mnemonic').value.trim();
                const psbt = document.getElementById('sendPsbt').value.trim();
                const network = document.getElementById('network').value;
                
                const signed = await sdk.signPsbt(mnemonic, psbt, network);
                
                const result = {
                    success: true,
                    signedPsbt: signed,
                    length: signed.length,
                    prefix: signed.substring(0, 10)
                };
                
                showResult('signSendResult', JSON.stringify(result, null, 2), 'success');
            } catch (error) {
                showResult('signSendResult', `Error: ${error.message}\n${error.stack}`, 'error');
            }
        }

        async function runAllTests() {
            const resultEl = document.getElementById('allTestsResult');
            showResult('allTestsResult', 'Running all tests...', 'loading');
            
            const results = [];
            
            // Test 1: Generate Keys
            try {
                showResult('allTestsResult', 'Running Test 1: Generate Keys...', 'loading');
                const network = document.getElementById('network').value;
                const keys1 = await sdk.generateKeys(network);
                results.push({ test: 'Generate Keys', success: true, keys: keys1 });
            } catch (error) {
                results.push({ test: 'Generate Keys', success: false, error: error.message });
            }
            
            // Test 2: Derive Keys
            try {
                showResult('allTestsResult', `Running Test 2: Derive Keys... (${results.length}/5)`, 'loading');
                const mnemonic = document.getElementById('mnemonic').value.trim();
                const network = document.getElementById('network').value;
                const keys2 = await sdk.deriveKeysFromMnemonic(mnemonic, network);
                results.push({ test: 'Derive Keys', success: true, keys: keys2 });
            } catch (error) {
                results.push({ test: 'Derive Keys', success: false, error: error.message });
            }
            
            // Test 3: Sign UTXO PSBT
            try {
                showResult('allTestsResult', `Running Test 3: Sign UTXO PSBT... (${results.length}/5)`, 'loading');
                const mnemonic = document.getElementById('mnemonic').value.trim();
                const psbt = document.getElementById('utxoPsbt').value.trim();
                const network = document.getElementById('network').value;
                const signed1 = await sdk.signPsbt(mnemonic, psbt, network);
                results.push({ test: 'Sign UTXO PSBT', success: true, signedLength: signed1.length });
            } catch (error) {
                results.push({ test: 'Sign UTXO PSBT', success: false, error: error.message });
            }
            
            // Test 4: Sign Send PSBT
            try {
                showResult('allTestsResult', `Running Test 4: Sign Send PSBT... (${results.length}/5)`, 'loading');
                const mnemonic = document.getElementById('mnemonic').value.trim();
                const psbt = document.getElementById('sendPsbt').value.trim();
                const network = document.getElementById('network').value;
                const signed2 = await sdk.signPsbt(mnemonic, psbt, network);
                results.push({ test: 'Sign Send PSBT', success: true, signedLength: signed2.length });
            } catch (error) {
                results.push({ test: 'Sign Send PSBT', success: false, error: error.message });
            }
            
            // Summary
            const passed = results.filter(r => r.success).length;
            const total = results.length;
            const summary = `Tests Complete: ${passed}/${total} passed\n\n${JSON.stringify(results, null, 2)}`;
            
            showResult('allTestsResult', summary, passed === total ? 'success' : 'error');
        }

        // Event listeners
        document.getElementById('testGenerateKeys').addEventListener('click', testGenerateKeys);
        document.getElementById('testDeriveKeys').addEventListener('click', testDeriveKeys);
        document.getElementById('testSignUtxo').addEventListener('click', testSignUtxo);
        document.getElementById('testSignSend').addEventListener('click', testSignSend);
        document.getElementById('runAllTests').addEventListener('click', async () => {
            if (!(await loadSDK())) {
                showResult('allTestsResult', 'Failed to load SDK', 'error');
                return;
            }
            await runAllTests();
        });

        // Load SDK on page load
        window.addEventListener('load', async () => {
            const statusEl = document.createElement('div');
            statusEl.className = 'result info';
            statusEl.textContent = 'Loading SDK...';
            document.body.insertBefore(statusEl, document.body.firstChild);
            
            if (await loadSDK()) {
                statusEl.textContent = '‚úÖ SDK loaded successfully! Ready to test.';
                statusEl.className = 'result success';
            } else {
                statusEl.textContent = '‚ùå Failed to load SDK. Check console for errors.';
                statusEl.className = 'result error';
            }
        });
    </script>
</body>
</html>

